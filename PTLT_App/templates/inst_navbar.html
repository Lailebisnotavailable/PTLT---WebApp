{% load static %}
<!DOCTYPE html>
<html lang="en">

<!-- Instructor Top Navigation Bar -->
<div class="d-flex justify-content-between align-items-center mb-3 nav_top">
    <div class="d-flex align-items-center nav_links">
        <strong class="pe-3 me-3 fs-5 ptlt">PTLT</strong>
        <a href="{% url 'student_attendance_records' %}" class="text-decoration-none border-end pe-3 me-3 custom-link">Student Attendance Records</a>
        <a href="{% url 'schedule' %}" class="text-decoration-none custom-link">Schedule</a>
    </div>

    <div class="d-flex align-items-center gap-3 pe-3">
        <button id="helpBtn" class="btn btn-outline-info" type="button">Need Help?</button>
        <a href="{% url 'logout' %}" class="btn btn-outline-danger logout_btn">Logout</a>
    </div>
</div>

<div class="modal fade" id="helpGuideModal" tabindex="-1" aria-labelledby="helpGuideLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title" id="helpGuideLabel">Help Guide</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex justify-content-center" id="helpSlide">
        <img id="helpImage" src="{% static 'image/attendance_records_inst.png' %}" alt="Help Guide Step" class="img-fluid rounded shadow" style="max-height: 75vh;" />
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <button id="prevHelp" class="btn btn-secondary">Previous</button>
        <button id="nextHelp" class="btn btn-primary">Next</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const helpImage = document.getElementById("helpImage");
    const helpModal = document.getElementById("helpGuideModal");
    const helpSteps = [
      "{% static 'image/attendance_records_inst.png' %}",
      "{% static 'image/schedule_inst.png' %}"
    ];

    let currentStep = 0;
    let modalInstance = null;

    function updateImage() {
      helpImage.src = helpSteps[currentStep];
    }

    // Create modal instance only once
    function getModalInstance() {
      if (!modalInstance) {
        modalInstance = new bootstrap.Modal(helpModal, {
          keyboard: true,
          backdrop: true
        });
      }
      return modalInstance;
    }

    // Clean up function to ensure backdrop is removed
    function cleanupModal() {
      // Remove any lingering backdrops
      const backdrops = document.querySelectorAll('.modal-backdrop');
      backdrops.forEach(backdrop => backdrop.remove());
      
      // Restore body scroll
      document.body.classList.remove('modal-open');
      document.body.style.overflow = '';
      document.body.style.paddingRight = '';
    }

    document.getElementById("prevHelp").addEventListener("click", function () {
      if (currentStep > 0) {
        currentStep--;
        updateImage();
      }
    });

    document.getElementById("nextHelp").addEventListener("click", function () {
      if (currentStep < helpSteps.length - 1) {
        currentStep++;
        updateImage();
      }
    });

    document.getElementById("helpBtn").addEventListener("click", function () {
      const modal = getModalInstance();
      modal.show();
    });

    // Add event listeners for modal close events
    helpModal.addEventListener('hidden.bs.modal', function () {
      cleanupModal();
      currentStep = 0; // Reset to first step
      updateImage();
    });

    // Additional safety cleanup for the close button
    helpModal.addEventListener('hide.bs.modal', function () {
      setTimeout(cleanupModal, 100); // Small delay to ensure Bootstrap finishes
    });

    // Force cleanup on ESC key or backdrop click
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && helpModal.classList.contains('show')) {
        cleanupModal();
      }
    });
  });
</script>

<main>
    {% block content %}{% endblock %}
    
</main>

<!-- Footer section -->
<footer class="footer bg-dark text-light py-5">
  <div class="container"> <!-- ✅ Add container here to center content -->
    <div class="row">
      <div class="col-md-4 mb-4">
        <h4>About Us</h4>
        <p>
            Our system provides accurate attendance monitoring, supports fingerprint-based authentication, and allows easy generation of hardcopy attendance records.
        </p>
      </div>

      <div class="col-md-4 mb-4">
        <h4>Contact Us</h4>
        <p><i class="fa fa-map-marker-alt"></i> Address: CQT Avenue, Salawag, Dasmariñas City, Cavite</p>
        <p><i class="fa fa-phone"></i> Mobile Number: +63 919 616 1221 </p>
        <p><i class="fa fa-envelope"></i> Email: salinas.markjoshua.g@gmail.com</p>
      </div>

      <div class="col-md-4 mb-4">
        <h4>Follow Us</h4>
        <p>
          <a href="#" class="me-2"><i class="fab fa-facebook-f"></i></a>
          <a href="#" class="me-2"><i class="fab fa-twitter"></i></a>
          <a href="#" class="me-2"><i class="fab fa-instagram"></i></a>
          <a href="#" class="me-2"><i class="fab fa-youtube"></i></a>
        </p>
      </div>
    </div>
  </div>
  <!-- Optional: add container to footer-bottom too if it’s also misaligned -->
  <div class="footer-bottom text-center mt-4">
    <p>&copy; 2025 PTLT | All Rights Reserved</p>
  </div>
   <!-- Logout confirmation modal (add to admin_navbar.html and instructor_navbar.html) -->
<div class="modal fade" id="confirmLogoutModal" tabindex="-1" aria-labelledby="confirmLogoutLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmLogoutLabel">Confirm Logout</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center text-dark">
        <i class="fa fa-exclamation-triangle fa-3x text-warning mb-3"></i>
        <h5 class="fw-bold">Are you sure you want to logout?</h5>
        <p class="text-muted">You will be redirected to the login page.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <!-- This button will trigger the logout when clicked (handled by JS below) -->
        <button type="button" id="confirmLogoutBtn" class="btn btn-danger">Yes, Logout</button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  // Find modal element
  const modalEl = document.getElementById('confirmLogoutModal');
  if (!modalEl) return; // nothing to do if modal missing

  const bsModal = new bootstrap.Modal(modalEl, { keyboard: true, backdrop: 'static' });
  let logoutHref = null;

  // Attach click handler to any logout buttons/links
  document.querySelectorAll('.logout_btn').forEach(btn => {
    btn.addEventListener('click', function (e) {
      e.preventDefault(); // stop immediate navigation
      logoutHref = btn.getAttribute('href'); // remember where to go
      // optionally update modal text if you want per-button messaging:
      // modalEl.querySelector('.modal-body p').textContent = 'Are you sure you want to logout, ' + userName + '?';
      bsModal.show();
    });
  });

  // Confirm button on modal — perform the redirect
  const confirmBtn = modalEl.querySelector('#confirmLogoutBtn');
  confirmBtn.addEventListener('click', function () {
    if (logoutHref) {
      // Use location.assign so back behavior is unchanged
      window.location.assign(logoutHref);
    } else {
      bsModal.hide();
    }
  });
});
</script>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>